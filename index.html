<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DONGULI | 咚咕哩</title>
    
    <link rel="icon" href="favicon.ico">

    <style>
        :root {
            /* 視覺系統：溫潤、自然 */
            --bg-color: #F9F8F4;       /* 淺米色背景 */
            --nav-bg: #FFFFFF;         /* 導覽列純白 */
            --text-main: #333333;      /* 主要文字 */
            --text-sub: #777777;       /* 次要文字 */
            --accent-color: #948068;   /* 品牌主色 (棕色系) */
            
            --font-serif: "Times New Roman", "Songti TC", serif;
            --font-sans: "Helvetica Neue", Arial, sans-serif;
            
            --nav-height: 80px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            letter-spacing: 0.05em;
            padding-top: var(--nav-height); /* 預留導覽列高度 */
        }

        /* =========================================
           NAVBAR (重新設計)
           風格：穩重、置中、清晰
           ========================================= */
        nav {
            position: fixed; top: 0; left: 0; width: 100%;
            height: var(--nav-height);
            background-color: var(--nav-bg);
            border-bottom: 1px solid #EBEBEB;
            z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px;
        }

        /* 左側 Logo */
        .logo { 
            font-family: var(--font-serif); 
            font-size: 1.6rem; 
            font-weight: bold; 
            color: #000; 
            letter-spacing: 0.1em; 
            cursor: pointer;
            z-index: 1002; /* 確保比手機選單高 */
        }

        /* 中間選單 (電腦版) */
        .nav-menu { 
            display: flex; 
            align-items: center; 
            gap: 40px; 
            height: 100%;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-sub);
            font-size: 0.95rem;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
            position: relative;
            padding: 5px 0;
        }
        
        .nav-link:hover, .nav-link.active { color: #000; }
        
        /* 底部線條動畫 */
        .nav-link::after {
            content: ''; position: absolute; left: 0; bottom: 0; width: 0%; height: 1px;
            background-color: #000; transition: width 0.3s ease;
        }
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }

        /* Dropdown 容器 */
        .dropdown { position: relative; height: 100%; display: flex; align-items: center; }
        
        /* Dropdown 內容 (電腦版懸浮選單) */
        .dropdown-menu {
            position: absolute;
            top: 100%; left: 50%;
            transform: translateX(-50%);
            background: #FFF;
            min-width: 200px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid #eee;
            padding: 10px 0;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            border-radius: 4px;
        }
        
        .dropdown:hover .dropdown-menu {
            opacity: 1; visibility: visible; top: 80%; /* 微微上移產生動畫感 */
        }

        .dropdown-item {
            display: block;
            padding: 12px 20px;
            color: var(--text-sub);
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.2s;
            text-align: center;
        }
        .dropdown-item:hover { background-color: #F9F9F9; color: var(--accent-color); }
        .shop-all-btn { color: var(--accent-color); font-weight: bold; border-bottom: 1px solid #f0f0f0; }

        /* 手機版漢堡按鈕 */
        .hamburger { 
            display: none; 
            cursor: pointer; 
            z-index: 1002;
            padding: 10px;
        }
        .hamburger div {
            width: 25px; height: 2px; background-color: #333; margin: 6px 0;
            transition: 0.4s;
        }

        /* =========================================
           RWD 手機版選單 (全螢幕遮罩)
           ========================================= */
        @media (max-width: 768px) {
            nav { padding: 0 20px; }
            .nav-menu { display: none; } /* 隱藏原本的選單 */
            .hamburger { display: block; }

            /* 手機版全螢幕選單容器 */
            .mobile-menu-overlay {
                position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
                background-color: #FFF;
                z-index: 1001;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 30px;
                transform: translateY(-100%); /* 預設收在上面 */
                transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                display: flex;
            }
            
            .mobile-menu-overlay.open { transform: translateY(0); }

            .mobile-link {
                font-size: 1.5rem;
                font-family: var(--font-serif);
                color: #333;
                cursor: pointer;
            }

            /* 手機版 Dropdown 改為直接列出 */
            .mobile-dropdown-container {
                display: flex; flex-direction: column; align-items: center; gap: 15px;
                margin-top: 10px; padding-top: 20px; border-top: 1px dashed #ddd;
                max-height: 40vh; overflow-y: auto; width: 80%;
            }
            .mobile-sub-item {
                font-size: 1rem; color: #666; cursor: pointer;
            }
            
            /* 漢堡變換成 X */
            .hamburger.active div:nth-child(1) { transform: rotate(-45deg) translate(-5px, 6px); }
            .hamburger.active div:nth-child(2) { opacity: 0; }
            .hamburger.active div:nth-child(3) { transform: rotate(45deg) translate(-5px, -6px); }
        }

        /* =========================================
           頁面內容與排版
           ========================================= */
        .page-section { display: none; width: 100%; animation: fadeIn 0.5s ease; padding-bottom: 60px; }
        .page-section.active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- 修正：Banner 樣式 (滿版 + 文字右下) --- */
        #dynamic-pages-root .page-section { max-width: 100%; }
        /* 一般頁面限制寬度，但商品頁面(dynamic)滿版 */
        #page-home, #page-about, #page-available { max-width: 1200px; margin: 0 auto; padding: 0 20px 60px; }

        .category-banner {
            width: 100%;
            height: 400px; /* 增加高度更有氣勢 */
            position: relative;
            margin-bottom: 50px;
            background-color: #E0E0E0;
        }
        .category-banner img { width: 100%; height: 100%; object-fit: cover; }
        
        .banner-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); /* 漸層由下往上 */
        }

        .banner-text-content {
            position: absolute; 
            bottom: 30px; 
            right: 30px; /* 靠右下角 */
            color: #fff; z-index: 2;
            text-align: right;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .banner-text-content h2 { font-size: 2.5rem; font-family: var(--font-serif); margin: 0; font-weight: normal; }
        .banner-text-content p { font-size: 1rem; opacity: 0.9; letter-spacing: 0.2em; text-transform: uppercase; margin-top: 5px; }

        /* --- 首頁 --- */
        .hero-section { text-align: center; margin-top: 20px; }
        .home-hero-container {
            width: 100%; max-width: 900px; margin: 30px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            line-height: 0; /* 消除圖片底部空隙 */
        }
        .home-hero-img { width: 100%; height: auto; display: block; }

        /* --- 商品列表 (無框 + 正方形) --- */
        .banner-controls-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 60px 40px;
        }

        .product-card { text-align: center; cursor: pointer; }
        
        .image-placeholder {
            width: 100%;
            aspect-ratio: 1 / 1; /* 正方形 */
            background-color: #F0F0F0;
            margin-bottom: 15px;
            overflow: hidden;
            position: relative;
        }
        .image-placeholder img {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.6s ease;
        }
        /* 只有照片放大，沒有外框浮起 */
        .product-card:hover .image-placeholder img { transform: scale(1.05); }

        .product-name { font-size: 1rem; color: #333; margin-bottom: 5px; letter-spacing: 0.05em; }
        .product-code { font-size: 0.8rem; color: #999; font-family: monospace; margin-bottom: 8px; }
        .price { color: var(--accent-color); font-weight: 500; }
        .status {
            font-size: 0.75rem; padding: 3px 12px; border: 1px solid #ddd;
            border-radius: 20px; display: inline-block; margin-top: 10px; color: #aaa;
        }
        .status.available { border-color: #4CAF50; color: #4CAF50; }

        /* About & Footer */
        .about-gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 40px; }
        .about-photo { width: 100%; aspect-ratio: 1/1; background: #eee; }
        .about-photo img { width: 100%; height: 100%; object-fit: cover; }
        
        footer { margin-top: 100px; padding: 40px 0; border-top: 1px solid #eee; text-align: center; color: #999; font-size: 0.8rem; }
        
        .controls { display: flex; justify-content: flex-end; margin-bottom: 30px; }
        .toggle-btn {
            background: none; border: 1px solid #ccc; padding: 8px 20px; border-radius: 50px;
            color: #666; cursor: pointer; transition: 0.3s;
        }
        .toggle-btn.active { background: var(--accent-color); color: #fff; border-color: var(--accent-color); }

    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="switchPage('home')">DONGULI</div>
        
        <div class="nav-menu">
            <div class="nav-link" onclick="switchPage('home')">Home</div>
            <div class="nav-link" onclick="switchPage('about')">About</div>
            
            <div class="dropdown">
                <div class="nav-link">Shop</div>
                <div class="dropdown-menu" id="desktop-shop-menu">
                    </div>
            </div>
        </div>

        <div class="hamburger" onclick="toggleMobileMenu()">
            <div></div><div></div><div></div>
        </div>
    </nav>

    <div class="mobile-menu-overlay" id="mobile-menu">
        <div class="mobile-link" onclick="switchPage('home')">Home</div>
        <div class="mobile-link" onclick="switchPage('about')">About</div>
        <div class="mobile-link" style="color: var(--accent-color); border-bottom: 2px solid var(--accent-color);">Shop Categories</div>
        
        <div class="mobile-dropdown-container" id="mobile-shop-list">
            </div>
    </div>

    <div id="page-home" class="page-section active-page">
        <div class="hero-section">
            <h1 style="font-family: var(--font-serif); font-size: 2.5rem; margin-bottom: 10px;">Wabi-Sabi Life</h1>
            <p style="color:#888;">生活裡的溫柔細節</p>
            
            <div class="home-hero-container" id="home-hero-root"></div>
            
            <p style="font-style: italic; color:#666; margin-bottom: 30px;">"一顆橡實，靜靜落地，等待著屬於自己的季節。"</p>
            <button class="toggle-btn" onclick="switchPage('available')">前往現貨區 (Shop Available)</button>
        </div>
    </div>

    <div id="page-about" class="page-section">
        <div style="max-width: 800px; margin: 0 auto; text-align: center;">
            <h2 style="font-family: var(--font-serif); margin-bottom: 10px;">Brand Story</h2>
            <p style="color:#999; margin-bottom: 40px;">關於咚咕哩</p>
            <div style="line-height: 2.2; color: #555;">
                <p>DONGULI 來自於對自然的觀察與熱愛。</p>
                <p>我們相信器皿不只是盛裝的工具，更是生活情感的延伸。</p>
            </div>
            <div class="about-gallery" id="about-gallery-root"></div>
        </div>
    </div>

    <div id="page-available" class="page-section">
        <div style="text-align:center; margin-bottom: 60px;">
            <h2 style="font-family: var(--font-serif); color: #4CAF50;">Available Items</h2>
            <p style="color:#999;">現貨選購</p>
        </div>
        <div class="product-grid" id="grid-available"></div>
    </div>

    <div id="dynamic-pages-root"></div>

    <footer>
        <p>© 2024 DONGULI. All Rights Reserved.</p>
    </footer>

    <script>
        // ==========================================
        //  CSV 設定區 (請確保格式整齊，不要有額外縮排)
        // ==========================================
        const siteConfigCSV = `
type,key,image
HomeHero, Main, assets/home_hero.jpg
Banner, Hand-Carved (手雕系列), assets/banner_hc.jpg
Banner, Tableware (食器系列), assets/banner_ht.jpg
Banner, Round-Cap (圓帽系列), assets/banner_rc.jpg
Banner, Special (限定系列), assets/banner_sp.jpg
Banner, Lifestyle (生活選物), assets/banner_ls.jpg
Banner, Konishii Hayata (小西氏系列), assets/banner_kh.jpg
About, Photo 1, assets/about_1.jpg
About, Photo 2, assets/about_2.jpg
About, Photo 3, assets/about_3.jpg
About, Photo 4, assets/about_4.jpg
`;

        const productDataCSV = `
category,code,name,price,status,image
Hand-Carved (手雕系列), HC-1, 手雕咚咕哩, 1380, SOLD OUT, assets/hc1.jpg
Hand-Carved (手雕系列), HC-2, 手雕咚咕哩, 1380, SOLD OUT, assets/hc2.jpg
Hand-Carved (手雕系列), HC-3, 手雕咚咕哩, 1380, SOLD OUT, assets/hc3.jpg
Tableware (食器系列), HT-1, 蓋碗/食器, 1480, SOLD OUT, assets/ht1.jpg
Round-Cap (圓帽系列), RC-1, 圓帽咚咕哩, 1480, SOLD OUT, assets/rc1.jpg
Special (限定系列), SUN-1, 夏日薄荷, 1280, SOLD OUT, assets/sun1.jpg
Lifestyle (生活選物), FW-1, 一起去摘花吧, 1480, SOLD OUT, assets/fw1.jpg
`;

        // ==========================================
        //  修復後的 CSV 解析器
        //  能處理 \r\n, \n 以及空行問題
        // ==========================================
        function parseCSV(csvText) {
            // 1. 統一換行符號，並移除前後空白
            const cleanText = csvText.trim().replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            const lines = cleanText.split('\n');
            
            // 2. 取得標頭 (Header)
            const headers = lines[0].split(',').map(h => h.trim());
            const items = [];

            // 3. 逐行解析
            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].trim();
                if (!currentLine) continue; // 跳過空行

                const row = currentLine.split(',');
                // 只有當欄位數量相符時才解析，避免壞掉的資料
                if (row.length === headers.length) {
                    const obj = {};
                    headers.forEach((h, idx) => obj[h] = row[idx].trim());
                    items.push(obj);
                }
            }
            return items;
        }

        // 初始化資料
        const products = parseCSV(productDataCSV);
        const configs = parseCSV(siteConfigCSV); 
        let isHideSoldOut = false; 

        function getBannerImage(categoryName) {
            const config = configs.find(c => c.type === 'Banner' && c.key === categoryName);
            return config ? config.image : '';
        }

        function initWebsite() {
            const pagesRoot = document.getElementById('dynamic-pages-root');
            const aboutGalleryRoot = document.getElementById('about-gallery-root');
            const homeHeroRoot = document.getElementById('home-hero-root');
            const desktopMenu = document.getElementById('desktop-shop-menu');
            const mobileMenu = document.getElementById('mobile-shop-list');

            // 1. HomeHero
            const homeHeroConfig = configs.find(c => c.type === 'HomeHero');
            const heroImgSrc = homeHeroConfig ? homeHeroConfig.image : '';
            if(heroImgSrc) {
                homeHeroRoot.innerHTML = `<img src="${heroImgSrc}" class="home-hero-img" onerror="this.style.display='none'">`;
            } else {
                homeHeroRoot.innerHTML = '<div style="padding:100px; background:#eee; color:#999;">Home Hero Image Not Set</div>';
            }

            // 2. About Photos
            configs.filter(c => c.type === 'About').forEach(p => {
                const div = document.createElement('div');
                div.className = 'about-photo';
                div.innerHTML = `<img src="${p.image}" onerror="this.style.display='none'">`;
                aboutGalleryRoot.appendChild(div);
            });

            // 3. 建立 Shop 選單 (包含 Desktop & Mobile)
            const categories = [...new Set(products.map(p => p.category))];

            // 加入 "Shop All" 按鈕
            const addMenuItem = (name, action, isSpecial = false) => {
                // Desktop
                const dItem = document.createElement('div');
                dItem.className = isSpecial ? 'dropdown-item shop-all-btn' : 'dropdown-item';
                dItem.innerText = name;
                dItem.onclick = action;
                desktopMenu.appendChild(dItem);

                // Mobile
                const mItem = document.createElement('div');
                mItem.className = 'mobile-sub-item';
                mItem.innerText = isSpecial ? '★ ' + name : name;
                if(isSpecial) mItem.style.color = 'var(--accent-color)';
                mItem.onclick = () => { action(); toggleMobileMenu(); }; // 手機點擊後要關閉選單
                mobileMenu.appendChild(mItem);
            };

            addMenuItem('Shop All (現貨)', () => switchPage('available'), true);

            categories.forEach((cat, index) => {
                const safeId = 'cat-' + index;
                const displayName = cat.split('(')[0];
                const subName = cat.includes('(') ? cat.split('(')[1].replace(')', '') : '';

                // 加入選單
                addMenuItem(displayName, () => switchPage(safeId));

                // 建立分類頁面
                const bannerImg = getBannerImage(cat);
                const bannerHTML = bannerImg ? `<img src="${bannerImg}" onerror="this.style.display='none'">` : '';

                const pageDiv = document.createElement('div');
                pageDiv.id = 'page-' + safeId;
                pageDiv.className = 'page-section';
                pageDiv.innerHTML = `
                    <div class="category-banner">
                        ${bannerHTML}
                        <div class="banner-overlay"></div>
                        <div class="banner-text-content">
                            <h2>${displayName}</h2>
                            <p>${subName}</p>
                        </div>
                    </div>
                    
                    <div class="banner-controls-container">
                        <div class="controls">
                            <button class="toggle-btn" onclick="toggleStock(this)">隱藏售完 (Hide Sold Out)</button>
                        </div>
                        <div class="product-grid" id="grid-${safeId}"></div>
                    </div>
                `;
                pagesRoot.appendChild(pageDiv);
                renderCategoryProducts(safeId, cat);
            });

            renderAvailablePage();
        }

        function renderCategoryProducts(safeId, categoryName) {
            const grid = document.getElementById('grid-' + safeId);
            grid.innerHTML = '';
            const items = products.filter(p => p.category === categoryName);
            items.forEach(item => {
                if (isHideSoldOut && item.status === 'SOLD OUT') return;
                grid.appendChild(createProductCard(item));
            });
        }

        function renderAvailablePage() {
            const grid = document.getElementById('grid-available');
            grid.innerHTML = '';
            const items = products.filter(p => p.status !== 'SOLD OUT');
            if(items.length === 0) {
                grid.innerHTML = '<p style="grid-column:1/-1; text-align:center; color:#999; margin-top:30px;">目前沒有現貨 / Out of Stock</p>';
                return;
            }
            items.forEach(item => grid.appendChild(createProductCard(item, true)));
        }

        function createProductCard(item) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            const isSoldOut = item.status === 'SOLD OUT';
            const statusClass = isSoldOut ? 'status' : 'status available';
            const imgContent = item.image.includes('.') ? 
                `<img src="${item.image}" onerror="this.parentNode.innerText='${item.code}'">` : item.code;
            
            card.innerHTML = `
                <div class="image-placeholder">${imgContent}</div>
                <div class="product-name">${item.name}</div>
                <div class="product-code">${item.code}</div>
                <div class="price">NT$ ${item.price}</div>
                <div class="${statusClass}">${item.status}</div>
            `;
            return card;
        }

        function switchPage(pageId) {
            // 切換頁面
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active-page'));
            const target = document.getElementById('page-' + pageId);
            if(target) target.classList.add('active-page');
            
            // 關閉手機選單 (如果有開)
            document.getElementById('mobile-menu').classList.remove('open');
            document.querySelector('.hamburger').classList.remove('active');
            
            window.scrollTo(0, 0);
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('open');
            document.querySelector('.hamburger').classList.toggle('active');
        }

        function toggleStock(btn) {
            isHideSoldOut = !isHideSoldOut;
            btn.classList.toggle('active');
            const categories = [...new Set(products.map(p => p.category))];
            categories.forEach((cat, index) => renderCategoryProducts('cat-' + index, cat));
        }

        // 啟動
        initWebsite();
    </script>
</body>
</html>