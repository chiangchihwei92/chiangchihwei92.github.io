<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#F9F7F2">
    
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://docs.google.com">
    <link rel="preconnect" href="https://www.googletagmanager.com">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DMSXQ41WHS"></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DMSXQ41WHS');
    </script>

    <meta name="description" content="DONGULI 咚咕哩 - 自然・陶・生活。">
    <meta name="robots" content="index, follow">

    <!-- Open Graph Meta Tags for Social Media Sharing -->
    <meta property="og:title" content="DONGULI | 咚咕哩">
    <meta property="og:description" content="DONGULI 咚咕哩 - 自然・陶・生活。">
    <meta property="og:image" content="https://chiangchihwei92.github.io/assets/home_hero.jpg">
    <meta property="og:url" content="https://chiangchihwei92.github.io/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="DONGULI">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="DONGULI | 咚咕哩">
    <meta name="twitter:description" content="DONGULI 咚咕哩 - 自然・陶・生活。">
    <meta name="twitter:image" content="https://chiangchihwei92.github.io/assets/home_hero.jpg">

    <title>DONGULI | 咚咕哩</title>
    <link rel="canonical" href="" id="canonical-link">
    <script type="application/ld+json" id="json-ld-data"></script>
    
    <!-- Favicon for Google Search and Browsers -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/favicon.ico">
    
    <link rel="preload" as="image" href="assets/home_hero.jpg" fetchpriority="high">
    
    <style>
        :root {
            --bg-color: #F9F7F2; 
            --text-color: #333333;
            --font-main: "Helvetica Neue", Helvetica, Arial, "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif;
            --font-serif: "Georgia", "Times New Roman", "Songti TC", "SimSun", serif; /* 用於引用的字體 */
            --nav-height: 70px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            letter-spacing: 0.05em;
            padding-top: var(--nav-height);
            overflow-x: hidden;
            width: 100%;
        }

        body.menu-open { overflow: hidden; }

        /* --- Global Loader Styles --- */
        #global-loader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: var(--bg-color);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.6s ease, visibility 0.6s ease;
            opacity: 1; visibility: visible;
        }

        #global-loader.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .icon-bounce-wrapper {
            animation: bounceGravity 0.5s infinite alternate cubic-bezier(0.6, 0.05, 1, 0.5);
            position: relative;
            z-index: 2;
        }

        .loader-icon.spinning {
            width: 50px;
            height: 50px;
            opacity: 0.9;
            animation: spinIcon 2s linear infinite;
            display: block;
        }

        .icon-shadow {
            width: 40px;
            height: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 50%;
            margin-top: -4px;
            margin-bottom: 30px;
            animation: shadowGravity 0.5s infinite alternate cubic-bezier(0.6, 0.05, 1, 0.5);
            z-index: 1;
            filter: blur(2px);
        }

        .loader-text {
            font-size: 0.9rem;
            color: #888;
            letter-spacing: 0.15em;
            font-weight: 500;
            text-transform: uppercase;
        }

        @keyframes spinIcon { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes bounceGravity {
            0% { transform: translateY(-35px); } 
            100% { transform: translateY(0); }
        }
        @keyframes shadowGravity {
            0% { transform: scale(0.4); opacity: 0.1; }
            100% { transform: scale(1.1); opacity: 0.6; } 
        }

        .dot { display: inline-block; animation: bounceDot 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        .dot:nth-child(3) { animation-delay: 0s; }
        
        @keyframes bounceDot {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* --- Skeleton --- */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .skeleton {
            background: #e0e0e0;
            background-image: linear-gradient(90deg, #e0e0e0 25%, #eeeeee 50%, #e0e0e0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s ease-in-out infinite;
            width: 100%; height: 100%; display: block;
            position: absolute; top: 0; left: 0; 
            z-index: 1;
            will-change: background-position;
        }

        /* --- Navbar --- */
        nav {
            position: fixed; top: 0; left: 0; width: 100%;
            height: var(--nav-height); 
            padding: 0 40px;
            background: linear-gradient(180deg, rgba(249, 247, 242, 0.98) 0%, rgba(249, 247, 242, 0.9) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid rgba(0,0,0,0.03);
            transition: all 0.3s ease;
        }

        .logo { 
            font-size: 1.4rem; font-weight: 700; 
            cursor: pointer; color: #111; letter-spacing: 0.1em; 
            text-transform: uppercase;
            z-index: 1100;
            display: flex; align-items: center; 
        }
        .logo-icon { height: 24px; width: auto; margin-right: 12px; opacity: 0.8; display: block; }
        
        .nav-menu { display: flex; gap: 40px; align-items: center; height: 100%; }

        .nav-btn {
            background: none; border: none; font-size: 0.9rem; font-weight: 600;
            font-family: var(--font-main); cursor: pointer; color: #666; 
            position: relative; padding: 25px 0; 
            letter-spacing: 0.1em;
            transition: color 0.3s ease;
            text-transform: uppercase;
        }
        
        @media (min-width: 769px) { .nav-btn:hover { color: #000; } }
        .nav-btn.active { color: #000; }
        .nav-btn::after {
            content: ''; position: absolute; bottom: 15px; left: 50%; width: 0; height: 1px;
            background-color: #000; transition: all 0.3s ease; transform: translateX(-50%);
        }
        .nav-btn:hover::after, .nav-btn.active::after { width: 100%; }

        /* Dropdown */
        .dropdown { position: relative; height: 100%; display: flex; align-items: center; }
        
        .dropdown-content {
            position: absolute; top: 100%; right: 0; left: auto;
            padding-top: 10px; opacity: 0; pointer-events: none; transition: all 0.2s ease;
            visibility: hidden; z-index: 1002;
        }
        
        .dropdown-inner {
            background-color: #fff; min-width: 200px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            padding: 10px 0; border: 1px solid rgba(0,0,0,0.05);
            text-align: left; transform: translateY(10px);
            transition: transform 0.3s ease; white-space: nowrap; 
        }

        @media (min-width: 769px) {
            .dropdown:hover .dropdown-content { opacity: 1; pointer-events: auto; visibility: visible; }
            .dropdown:hover .dropdown-inner { transform: translateY(0); }
        }

        .dropdown-item { 
            padding: 12px 25px; font-size: 0.85rem; cursor: pointer; 
            transition: all 0.2s ease; color: #666; display: block;
        }
        .dropdown-item:hover { color: #000; background-color: #f9f9f9; padding-left: 25px; transform: translateX(4px); }
        .shop-all-item { color: #333; font-weight: 700; border-bottom: 1px solid #f0f0f0; margin-bottom: 5px; }

        .hamburger { display: none; background: none; border: none; cursor: pointer; padding: 10px; z-index: 1200; }
        .hamburger span {
            display: block; width: 24px; height: 2px; background-color: #333;
            margin: 6px 0; transition: 0.3s;
        }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }
        
        .arrow-indicator {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-right: 1.5px solid #888;
            border-bottom: 1.5px solid #888;
            transform: rotate(45deg);
            margin-left: 8px;
            margin-bottom: 3px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover .arrow-indicator,
        .nav-btn.active .arrow-indicator { border-color: #000; }

        @media (min-width: 769px) {
            .dropdown:hover .arrow-indicator {
                transform: rotate(225deg);
                margin-bottom: -1px;
            }
        }

        @media (max-width: 768px) {
            .arrow-indicator { display: none; }
            nav { padding: 0 20px; }
            .logo { line-height: 70px; font-size: 1.2rem; }
            .hamburger { display: block; }
            .nav-menu {
                position: fixed; top: 0; right: 0; 
                width: 80%; max-width: 320px; height: 100vh;
                background-color: #fff; flex-direction: column; align-items: flex-start;
                padding: 80px 30px; gap: 0; transform: translateX(100%); 
                transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
                box-shadow: -10px 0 30px rgba(0,0,0,0.05); z-index: 1100; overflow-y: auto; 
            }
            .nav-menu.open { transform: translateX(0); }
            .menu-overlay {
                position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
                background: rgba(0,0,0,0.4); z-index: 900; 
                opacity: 0; pointer-events: none; transition: 0.3s;
            }
            .menu-overlay.active { opacity: 1; pointer-events: auto; }
            .nav-btn { 
                font-size: 1rem; width: 100%; text-align: left; padding: 20px 0; 
                border-bottom: 1px solid #f5f5f5; color: #333; display: flex; justify-content: space-between; 
            }
            .nav-btn::after { display: none; }
            .dropdown { display: block; width: 100%; height: auto; }
            .dropdown-content { position: static; padding: 0; opacity: 1; visibility: visible; pointer-events: auto; }
            .dropdown-inner {
                background: #fafafa; width: 100%; border: none; box-shadow: none; transform: none;
                max-height: 0; overflow: hidden; transition: max-height 0.5s ease; padding: 0;
            }
            .dropdown-inner.show { max-height: 800px; border-bottom: 1px solid #f5f5f5; margin-bottom: 10px; }
            .dropdown-item:hover { transform: none; }
            #btn-shop::after { content: '+'; position: static; transform: none; font-size: 1.4rem; font-weight: 300; margin-left: 10px; }
            #btn-shop.open::after { content: '-'; }
        }

        /* --- Page Layout --- */
        .page-section { display: none; width: 100%; animation: fadeIn 0.6s ease; }
        .page-section.active-page { display: block; }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translate3d(0, 10px, 0); } 
            to { opacity: 1; transform: translate3d(0, 0, 0); } 
        }

        .content-container {
            max-width: 1200px; margin: 0 auto; padding: 0 20px;
        }

        /* --- Hero Section & Ken Burns --- */
        .hero-section { width: 100%; position: relative; }
        
        .slideshow-container {
            width: 100%; 
            height: calc(100vh - var(--nav-height));
            min-height: 500px;
            max-height: 900px;
            background: #e0e0e0;
            overflow: hidden; 
            position: relative;
        }

        @keyframes kenBurns {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        .slide {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; object-fit: cover;
            transition: opacity 1.5s ease-in-out; 
            transform-origin: center center;
            will-change: opacity, transform;
        }
        .slide.active { opacity: 1; z-index: 1; animation: kenBurns 6s linear forwards; }

        .hero-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: 2; 
            background: linear-gradient(180deg, rgba(0,0,0,0) 50%, rgba(0,0,0,0.6) 100%);
            pointer-events: none;
        }

        .hero-text-container {
            position: absolute; bottom: 80px; left: 5%;
            z-index: 10; color: #fff; text-align: left;
            text-shadow: 0 2px 20px rgba(0,0,0,0.6);
            pointer-events: none;
        }
        .hero-text-container * { pointer-events: auto; }

        .hero-text-container h1 { font-size: 3.5rem; margin-bottom: 5px; font-weight: 700; letter-spacing: 0.05em; line-height: 1.1; }
        .hero-text-container p.subtitle { font-size: 1rem; letter-spacing: 0.2em; text-transform: uppercase; opacity: 0.9; margin-bottom: 20px; }
        .hero-text-container .quote { 
            font-size: 1.1rem; margin-bottom: 30px; font-weight: 300; opacity: 0.95; font-style: italic; display: block;
        }

        .hero-btn {
            background: transparent; 
            border: 1px solid #fff; color: #fff;
            padding: 12px 30px; border-radius: 50px; 
            font-size: 0.85rem; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 0.1em;
            display: inline-block;
        }
        .hero-btn:hover { background: #fff; color: #000; transform: translateY(-2px); }

        @media (max-width: 768px) {
            .hero-text-container { bottom: 60px; left: 20px; right: 20px; }
            .hero-text-container h1 { font-size: 2.5rem; }
            .hero-overlay { background: linear-gradient(180deg, rgba(0,0,0,0) 30%, rgba(0,0,0,0.6) 100%); }
        }

        .slide-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: rgba(255,255,255,0.1); border: none; color: #fff;
            font-size: 2rem; padding: 20px 15px; cursor: pointer; z-index: 10;
            transition: 0.3s;
        }
        .slide-btn:hover { background: rgba(255,255,255,0.3); }
        .slide-prev { left: 0; }
        .slide-next { right: 0; }

        .making-of-section {
            width: 100%;
            background-color: #fafafa;
            padding: 80px 20px;
            text-align: center;
            border-top: 1px solid #eee;
            margin-top: 40px;
            clear: both; 
            display: block;
        }
        .making-of-section h3 { font-size: 1.5rem; color: #555; font-weight: 400; margin-bottom: 15px; }
        .making-of-section p { color: #999; font-size: 0.9rem; letter-spacing: 0.05em; }

        /* Category Header */
        .category-header-wrapper {
            position: relative; width: 100%; height: 45vh; min-height: 300px;
            margin-bottom: 50px; background: #e0e0e0; overflow: hidden;
        }
        .category-header-wrapper .slideshow-container { height: 100%; min-height: auto; max-height: none; }
        .category-text { 
            position: absolute; bottom: 40px; left: 5%; 
            z-index: 10; color: #fff; text-align: left; 
            text-shadow: 0 2px 15px rgba(0,0,0,0.5); pointer-events: none;
        }
        .category-text h2 { font-size: 3rem; margin: 0; font-weight: 700; }
        .category-text p { font-size: 1.1rem; opacity: 0.9; margin-top: 5px; }

        /* --- Product Grid --- */
        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 60px 40px; margin-bottom: 40px; 
        }
        .product-card { text-align: center; }
        
        .img-box {
            width: 100%; 
            aspect-ratio: 1/1; 
            background-color: transparent; 
            margin-bottom: 20px; 
            position: relative; overflow: hidden; cursor: pointer; 
        }
        
        .img-box img, .img-box video { 
            width: 100%; height: 100%; 
            object-fit: cover; 
            opacity: 0;        
            transition: opacity 0.6s ease, transform 0.8s ease; 
            position: absolute; top: 0; left: 0;
            will-change: opacity, transform;
        }

        .img-box .img-main.loaded { opacity: 1; z-index: 2; }
        .img-box .img-hover.loaded { opacity: 0; z-index: 3; }
        .product-card.has-hover:hover .img-box .img-hover.loaded { opacity: 1; }
        .product-card:hover .img-box img, 
        .product-card:hover .img-box video { transform: scale(1.05); }
        
        .note-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 30px 15px 15px 15px;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
            color: #fff; font-size: 0.9rem; font-weight: 400; letter-spacing: 0.08em;
            opacity: 0; transition: opacity 0.4s ease; z-index: 5;
            text-align: left; pointer-events: none;
            display: flex; align-items: flex-end; justify-content: center;
            text-align: center;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        .product-card:hover .note-overlay { opacity: 1; }

        .p-code { font-size: 0.75rem; color: #aaa; margin-bottom: 5px; }
        .p-name { font-size: 1rem; color: #333; margin-bottom: 8px; font-weight: 600; }
        .p-price { color: #555; font-size: 1rem; }
        
        /* Updated Status Style */
        .p-status { 
            font-size: 0.7rem; padding: 4px 12px; border: 1px solid #ddd; color: #aaa; 
            display: inline-block; margin-top: 15px; border-radius: 50px; 
            text-decoration: none; /* For link */
            transition: all 0.3s ease;
        }
        
        /* --- Making Of Gallery --- */
        .mo-gallery {
            column-count: 2; 
            column-gap: 10px;
            width: 100%;
            margin-top: 30px;
        }
        
        @media (min-width: 768px) {
            .mo-gallery { column-count: 3; }
        }
        
        @media (min-width: 1200px) {
            .mo-gallery { column-count: 5; }
        }

        .mo-item {
            break-inside: avoid; 
            margin-bottom: 10px;
            background: #fff;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            transition: transform 0.3s ease, filter 0.3s ease;
            cursor: pointer;
        }

        .mo-item:hover { 
            transform: translateY(-2px); 
            filter: brightness(1.05);
        }

        .mo-item img, .mo-item video {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
        }

        /* Available style (now likely an <a> tag) */
        .p-status.available { 
            border-color: #333; 
            color: #333; 
            background-color: transparent;
            cursor: pointer;
        }
        .p-status.available:hover {
            background-color: #333;
            color: #fff;
        }

        .controls-area { text-align: right; margin-bottom: 30px; position: relative; z-index: 5; }
        .toggle-btn {
            background: transparent; border: 1px solid #999; color: #666;
            padding: 8px 25px; border-radius: 30px; font-size: 0.85rem; cursor: pointer; transition: 0.3s;
        }
        .toggle-btn:hover, .toggle-btn.active { background: #333; color: white; border-color: #333; }

        /* About Page Styles */
        .about-container { max-width: 800px; margin: 0 auto; text-align: center; }
        
        .about-poetic-text {
            text-align: center;
            color: #555;
            letter-spacing: 0.08em;
            margin: 40px auto 60px;
        }
        .poetic-stanza {
            margin-bottom: 35px;
            line-height: 2.2;
        }
        .poetic-stanza.last { margin-bottom: 0; }
        
        .gallery-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 50px; }
        
        .gallery-item { 
            aspect-ratio: 1/1; 
            background: #f0f0f0; 
            overflow: hidden; 
            position: relative; 
        }
        
        .gallery-item img { 
            width: 100%; height: 100%; object-fit: cover; 
            opacity: 0; transition: transform 0.6s ease, opacity 0.5s ease; 
            position: relative; z-index: 2;
            will-change: transform;
        }
        .gallery-item img.loaded { opacity: 1; }
        .gallery-item:hover img { transform: scale(1.06); }
        
        .social-link {
            display: inline-flex; align-items: center; margin-top: 20px; text-decoration: none; color: #333; 
            border-bottom: 1px solid transparent; padding-bottom: 2px; transition: 0.2s;
        }
        .social-link:hover { border-bottom: 1px solid #333; }
        .social-icon { width: 20px; height: 20px; margin-right: 10px; fill: currentColor; display: block; }

        /* Quote / Disclaimer Text Style */
        .quote-container {
            max-width: 600px;
            margin: 60px auto 40px;
            padding: 0 20px;
            position: relative;
        }
        
        .quote-box {
            border-left: 3px solid #d0d0d0; /* 左側引用線 */
            padding-left: 25px;
            text-align: left;
            color: #666;
            font-family: var(--font-serif);
            font-style: italic; /* 營造引語感 */
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 30px;
            background: linear-gradient(to right, rgba(0,0,0,0.02), transparent);
            padding-top: 10px;
            padding-bottom: 10px;
        }
        
        .tech-disclaimer {
            font-size: 0.75rem;
            color: #bbb;
            text-align: center;
            font-family: var(--font-main);
            font-style: normal;
            line-height: 1.6;
            border-top: 1px solid #eee;
            padding-top: 20px;
            width: 80%;
            margin: 0 auto;
        }
        
        footer { text-align: center; padding: 80px 20px; color: #bbb; font-size: 0.75rem; border-top: 1px solid #f0f0f0; }

        /* Lightbox */
        .lightbox-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(30, 30, 30, 0.95); 
            z-index: 2000; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s ease;
            flex-direction: column; 
        }
        .lightbox-modal.active { display: flex; opacity: 1; }
        .lightbox-wrapper { position: relative; width: 90vw; height: 80vh; display: flex; align-items: center; justify-content: center; }
        .lightbox-content {
            max-width: 100%; max-height: 100%; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); 
            animation: zoomIn 0.3s ease; object-fit: contain;
        }
        .lightbox-caption {
            margin-top: 20px;
            text-align: center; color: rgba(255,255,255,0.9);
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            font-size: 1.1rem; font-weight: 300; letter-spacing: 0.1em;
            opacity: 0; transition: opacity 0.5s ease;
            max-width: 80%;
        }
        .lightbox-caption.has-text { opacity: 1; }
        .close-lightbox {
            position: absolute; top: 20px; right: 30px; color: #fff; font-size: 40px; 
            cursor: pointer; transition: 0.3s; z-index: 2005; line-height: 1; opacity: 0.8;
        }
        .close-lightbox:hover { transform: rotate(90deg); opacity: 1; }
        .lb-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: transparent; border: none; color: #fff;
            font-size: 3rem; padding: 20px; cursor: pointer; z-index: 2002;
            transition: 0.2s; font-weight: 300; opacity: 0.7;
        }
        .lb-btn:hover { opacity: 1; transform: translateY(-50%) scale(1.1); }
        .lb-prev { left: 10px; }
        .lb-next { right: 10px; }
        @keyframes zoomIn { from { transform: scale(0.95); } to { transform: scale(1); } }

    </style>
</head>
<body>

    <div id="global-loader">
        <div class="icon-bounce-wrapper">
            <img src="assets/favicon.ico" alt="Icon" class="loader-icon spinning" onerror="this.style.display='none'">
        </div>
        <div class="icon-shadow"></div>
        <div class="loader-text">
            Loading<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>
        </div>
    </div>

    <div class="menu-overlay" onclick="closeMenu()" aria-hidden="true"></div>

    <nav role="navigation" aria-label="Main navigation">
        <div class="logo" onclick="handleNavClick('home'); closeMenu()">
            <img src="assets/favicon.ico" alt="Icon" class="logo-icon" onerror="this.style.display='none'">
            DONGULI
        </div>
        
        <button class="hamburger" id="hamburger-btn" onclick="toggleMenu()" aria-label="Toggle menu" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <div class="nav-menu" id="nav-menu">
            <button class="nav-btn active" onclick="handleNavClick('home'); closeMenu()" id="btn-home">HOME</button>
            <button class="nav-btn" onclick="handleNavClick('about'); closeMenu()" id="btn-about">ABOUT</button>
            
            <div class="dropdown">
                <button class="nav-btn" id="btn-shop" onclick="toggleMobileShop(event)">
                    SHOP <span class="arrow-indicator"></span>
                </button>
                <div class="dropdown-content" id="shop-dropdown-content">
                    <div class="dropdown-inner" id="shop-dropdown-inner">
                        </div>
                </div>
            </div>
        </div>
    </nav>

    <div id="page-home" class="page-section active-page">
        <div class="hero-section">
            <div class="slideshow-container" id="home-hero-root">
                <div class="skeleton"></div>
            </div>
            
            <div class="hero-overlay"></div>
            
            <div class="hero-text-container">
                <h1>Donguli Ko-Lo Ko-Lo</h1>
                <p class="subtitle">Nature・Ceramics・Living</p>
                <p class="quote">"一顆橡實，靜靜落地，等待著屬於自己的季節。"</p>
                <button class="hero-btn" onclick="handleNavClick('available')">View Available Items</button>
            </div>
        </div>
    </div>

    <div id="page-about" class="page-section">
        <div class="category-header-wrapper">
            <div class="slideshow-container" id="banner-about">
                <div class="skeleton"></div>
            </div>
            <div class="hero-overlay"></div>
            <div class="category-text">
                <h2>About us</h2>
                <p>關於咚咕哩</p>
            </div>
        </div>

        <div class="content-container">
            <div class="about-container">
                <div class="about-poetic-text">
                    <div class="poetic-stanza">
                        <p>每件作品都由雙手塑造，承載時間的痕跡與釉色的流動</p>
                        <p>在陶土的粗糙與釉色的溫潤之間，尋找一種平靜的平衡</p>
                    </div>

                    <div class="poetic-stanza">
                        <p>它們各有模樣，卻同樣真實、溫暖，如同生活裡的一顆果實，靜靜陪你走過四季。</p>
                    </div>
                    
                    <div class="poetic-stanza last">
                        <p style="font-weight: 600; color: #333; margin-bottom: 5px;">DONGULI 來自於對自然的觀察與熱愛</p>
                        <p>希望當你捧著DONGULI時</p>
                        <p>能感受你與自然之間溫柔的連結</p>
                    </div>
                </div>

                <a href="https://www.instagram.com/DONGULI_wei/" target="_blank" class="social-link">
                    <svg class="social-icon" viewBox="0 0 448 512">
                        <path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/>
                    </svg>
                    Follow us on Instagram
                </a>

            </div>
            <div class="making-of-section" id="mo-section-about" style="display:none; margin-top: 60px;">
                    <div class="mo-gallery" id="mo-gallery-about"></div>
            </div>
        </div>
    </div>

    <div id="page-available" class="page-section">
        <div class="content-container">
            <div style="text-align: center; margin: 60px 0;">
                <h2 style="color: #111; font-size: 2rem; font-weight: 700;">Available Stock</h2>
                <p style="color: #999; letter-spacing: 0.1em; font-size: 0.9rem;">現貨選購</p>
            </div>
            
            <div class="quote-container" style="margin-top: 20px;">
                <div class="quote-box">
                    <p>一顆顆手捏的果實，承載時間與溫度，靜靜陪你走過四季。</p>
                    <p>每一件都獨一無二，你生活中的專屬夥伴。</p>
                </div>
            </div>

            <div class="product-grid" id="grid-available">
                <div class="product-card"><div class="img-box"><div class="skeleton"></div></div></div>
            </div>
        </div>

        <div class="content-container">
            <div class="tech-disclaimer" style="margin-bottom: 40px;">
                每件作品皆為手工製作，不對稱或不夠精準皆為手作的痕跡。<br>
                施釉層可能出現流釉、縮釉、小針孔皆為可能發生之情況。
            </div>
        </div>
    </div>

    <div id="dynamic-pages-root"></div>

    <footer>
        <p>© <span id="footer-year"></span> DONGULI. All Rights Reserved.</p>
    </footer>

    <div id="lightbox" class="lightbox-modal" onclick="closeLightbox(event)" role="dialog" aria-modal="true" aria-label="Image gallery">
        <span class="close-lightbox" aria-label="Close lightbox">&times;</span>
        <button class="lb-btn lb-prev" id="lb-prev" onclick="changeLightboxItem(-1)" aria-label="Previous image">&lt;</button>
        <div class="lightbox-wrapper" id="lightbox-wrapper"></div>
        <div id="lightbox-caption" class="lightbox-caption"></div>
        <button class="lb-btn lb-next" id="lb-next" onclick="changeLightboxItem(1)" aria-label="Next image">&gt;</button>
    </div>

    <script>
        // 設定區
        const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSox1X7TkN9sthpcPPEALmBn6zIpYGKSRowSXKodN3fkLf3X8NAzCKjltFjQk5xgK3-Kt5wuVCRUT25/pub?gid=1824240757&single=true&output=csv'; 
        const ORDER_FORM_LINK = 'https://forms.gle/4dy8TAiyLGzYatKN6'; // 訂購表單連結

        // 狀態變數
        let products = [];
        let configs = [];
        let categories = []; 
        let isHideSoldOut = false;
        let slideshowIntervals = {};
        let currentLbImages = [];
        let currentLbIndex = 0;
        let currentLbNote = "";

        // 瀏覽器上一頁/下一頁處理
        window.onpopstate = function(event) {
            if (event.state && event.state.page) switchPage(event.state.page, false);
            else switchPage('home', false);
        };

        function handleNavClick(pageId) { switchPage(pageId, true); }

        function hideLoader() {
            const loader = document.getElementById('global-loader');
            if (loader) {
                loader.classList.add('hidden');
                setTimeout(() => { loader.style.display = 'none'; }, 600);
            }
        }

        function preloadImage(src) {
            return new Promise((resolve) => {
                if (!src) { resolve(); return; }
                const img = new Image();
                img.onload = () => resolve();
                img.onerror = () => resolve(); 
                img.src = src;
            });
        }

        async function initWebsite() {
            document.getElementById('footer-year').innerText = new Date().getFullYear();
            
            // 安全機制：若載入太久強制顯示
            const safetyTimeout = setTimeout(() => {
                console.warn("Loading timeout, forcing display.");
                hideLoader();
            }, 5000);

            try {
                // 1. 載入資料
                const loadConfig = async () => {
                    try {
                        const response = await fetch('data.json');
                        if (response.ok) {
                            const data = await response.json();
                            configs = data.config || [];
                        }
                    } catch (e) {
                        console.warn("data.json not found, defaults.");
                        configs = [];
                    }
                };

                const loadCSV = async () => {
                    if (GOOGLE_SHEET_CSV_URL) {
                        try {
                            const csvResponse = await fetch(GOOGLE_SHEET_CSV_URL);
                            if (!csvResponse.ok) throw new Error(`CSV Fetch Failed: ${csvResponse.status}`);
                            const csvText = await csvResponse.text();
                            products = parseCSV(csvText);
                        } catch (err) {
                            console.error("Error loading product CSV:", err);
                        }
                    }
                };

                await Promise.all([loadConfig(), loadCSV()]);

                // Home Hero
                const homeHeroConfig = configs.find(c => c.type === 'HomeHero');
                if (homeHeroConfig) {
                    const images = Array.isArray(homeHeroConfig.image) ? homeHeroConfig.image : [homeHeroConfig.image];
                    renderSlideshow('home-hero-root', images);
                }

                const aboutBannerConfig = configs.find(c => c.type === 'Banner' && c.key === 'about');
                if (aboutBannerConfig) {
                    const images = Array.isArray(aboutBannerConfig.image) ? aboutBannerConfig.image : [aboutBannerConfig.image];
                    renderSlideshow('banner-about', images);
                }

                renderMakingOfGallery('about', 'about');

                setupCategories(); 
                renderAvailablePage();
                
                const urlParams = new URLSearchParams(window.location.search);
                let initialPageParam = urlParams.get('page') || 'home';
                let initialPageId = initialPageParam;

                const foundCatIndex = categories.findIndex(c => c.replace(/\s+/g, '') === initialPageParam);
                if (foundCatIndex !== -1) {
                    initialPageId = 'cat-' + foundCatIndex;
                }

                switchPage(initialPageId, false);

                let targetImage = null;
                if (initialPageId === 'home') {
                    if (homeHeroConfig) {
                        const images = Array.isArray(homeHeroConfig.image) ? homeHeroConfig.image : [homeHeroConfig.image];
                        if (images.length > 0) targetImage = images[0];
                    }
                } else if (initialPageId === 'about') {
                     if (aboutBannerConfig) {
                        const images = Array.isArray(aboutBannerConfig.image) ? aboutBannerConfig.image : [aboutBannerConfig.image];
                        if (images.length > 0) targetImage = images[0];
                     }
                } else if (initialPageId.startsWith('cat-')) {
                    const catIndex = parseInt(initialPageId.replace('cat-', ''));
                    if (categories[catIndex]) {
                        const catName = categories[catIndex];
                        const bannerConfig = configs.find(c => c.type === 'Banner' && c.key === catName);
                        if (bannerConfig) {
                            const images = Array.isArray(bannerConfig.image) ? bannerConfig.image : [bannerConfig.image];
                            if (images.length > 0) targetImage = images[0];
                        }
                    }
                }
                if (targetImage) {
                    await preloadImage(targetImage);
                }

            } catch (error) {
                console.error("Critical Error:", error);
                document.querySelectorAll('.skeleton').forEach(el => el.style.display = 'none');
            } finally {
                clearTimeout(safetyTimeout);
                hideLoader();
            }
        }

        function parseCSV(text) {
            const lines = text.trim().split(/\r?\n/);
            if (lines.length < 2) return [];
            
            const headers = lines[0].split(',').map(h => h.trim());
            const headerIndexCache = {};
            headers.forEach((h, idx) => { headerIndexCache[h] = idx; });
            
            const getVal = (rowArr, headerName) => {
                const idx = headerIndexCache[headerName];
                return idx !== undefined && idx < rowArr.length && rowArr[idx] ? rowArr[idx] : '';
            };

            const result = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const values = [];
                let currentVal = '';
                let inQuote = false;
                
                for(let j=0; j<line.length; j++) {
                    const char = line[j];
                    if(char === '"') {
                        inQuote = !inQuote;
                    } else if(char === ',' && !inQuote) {
                        values.push(currentVal.trim());
                        currentVal = '';
                    } else {
                        currentVal += char;
                    }
                }
                values.push(currentVal.trim());

                const cleanValues = values.map(v => v.replace(/^"|"$/g, '').trim());

                const product = {
                    category: getVal(cleanValues, 'Category'),
                    code: getVal(cleanValues, 'Code'),
                    name: getVal(cleanValues, 'Name'),
                    price: parseInt(getVal(cleanValues, 'Price (NTD)').replace(/,/g, '') || '0'),
                    status: getVal(cleanValues, 'Status'),
                    notes: getVal(cleanValues, 'Notes'), 
                    image: getVal(cleanValues, 'Image(s)')
                        .split(',')
                        .map(s => {
                            const trimmed = s.trim();
                            return trimmed.startsWith('assets/') ? trimmed : 'assets/' + trimmed;
                        })
                        .filter(s => s !== 'assets/')
                };

                if (product.name && product.category) {
                    result.push(product);
                }
            }
            return result;
        }

        function renderSlideshow(containerId, images) {
            const container = document.getElementById(containerId);
            if(!container) return;
            container.innerHTML = ''; 

            images.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                img.className = index === 0 ? 'slide active' : 'slide';
                img.alt = 'Slide Image';
                if (index === 0) img.fetchpriority = 'high';
                img.decoding = 'async';
                container.appendChild(img);
            });

            if (images.length > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'slide-btn slide-prev';
                prevBtn.innerHTML = '&lt;'; 
                prevBtn.onclick = () => changeSlide(containerId, -1);

                const nextBtn = document.createElement('button');
                nextBtn.className = 'slide-btn slide-next';
                nextBtn.innerHTML = '&gt;'; 
                nextBtn.onclick = () => changeSlide(containerId, 1);

                container.appendChild(prevBtn);
                container.appendChild(nextBtn);

                startAutoPlay(containerId);
                container.onmouseenter = () => stopAutoPlay(containerId);
                container.onmouseleave = () => startAutoPlay(containerId);
            }
        }

        function changeSlide(containerId, direction) {
            const container = document.getElementById(containerId);
            const slides = container.querySelectorAll('.slide');
            let activeIndex = 0;

            slides.forEach((slide, index) => {
                if (slide.classList.contains('active')) {
                    activeIndex = index;
                    slide.classList.remove('active');
                }
            });

            let newIndex = activeIndex + direction;
            if (newIndex >= slides.length) newIndex = 0;
            if (newIndex < 0) newIndex = slides.length - 1;

            slides[newIndex].classList.add('active');
        }

        function startAutoPlay(id) {
            if(slideshowIntervals[id]) clearInterval(slideshowIntervals[id]);
            slideshowIntervals[id] = setInterval(() => { changeSlide(id, 1); }, 6000);
        }

        function stopAutoPlay(id) {
            if(slideshowIntervals[id]) clearInterval(slideshowIntervals[id]);
        }

        function setupCategories() {
            categories = [...new Set(products.map(p => p.category))]; 
            const shopInner = document.getElementById('shop-dropdown-inner');
            const pagesRoot = document.getElementById('dynamic-pages-root');

            shopInner.innerHTML = '';
            pagesRoot.innerHTML = '';

            const shopAllLink = document.createElement('div');
            shopAllLink.className = 'dropdown-item shop-all-item';
            shopAllLink.innerText = 'View Available / 查看現貨';
            shopAllLink.onclick = () => { handleNavClick('available'); closeMenu(); };
            shopInner.appendChild(shopAllLink);

            categories.forEach((cat, index) => {
                const safeId = 'cat-' + index;
                
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                item.innerText = cat;
                item.onclick = () => { handleNavClick(safeId); closeMenu(); };
                shopInner.appendChild(item);

                const bannerConfig = configs.find(c => c.type === 'Banner' && c.key === cat);
                let bannerImages = [];
                if (bannerConfig) bannerImages = Array.isArray(bannerConfig.image) ? bannerConfig.image : [bannerConfig.image];
                
                const catName = cat.split('(')[0].trim(); 
                const catChinese = cat.includes('(') ? cat.split('(')[1].replace(')', '').trim() : catName;

                const pageDiv = document.createElement('div');
                pageDiv.id = 'page-' + safeId;
                pageDiv.className = 'page-section';
                
                pageDiv.innerHTML = `
                    <div class="category-header-wrapper">
                        <div class="slideshow-container" id="banner-${safeId}">
                            <div class="skeleton"></div>
                        </div>
                        <div class="hero-overlay"></div>
                        <div class="category-text">
                            <h2>${catName}</h2>
                            <p>${catChinese}</p>
                        </div>
                    </div>

                    <div class="content-container">
                        <div class="quote-container" style="margin: 40px auto 20px;">
                            <div class="quote-box">
                                <p>一顆顆手捏的果實，承載時間與溫度，靜靜陪你走過四季。</p>
                                <p>每一件都獨一無二，你生活中的專屬夥伴。</p>
                            </div>
                        </div>

                        <div class="controls-area">
                             <button class="toggle-btn" onclick="toggleStock(this, '${safeId}', '${cat}')">隱藏售完 Hide Sold Out</button>
                        </div>
                        <div class="product-grid" id="grid-${safeId}">
                            <div class="skeleton" style="height:300px; grid-column:1/-1;"></div>
                        </div>
                    </div>
                    
                    <div class="making-of-section" id="mo-section-${safeId}" style="display:none;">
                        <div class="content-container">
                            <h3>${catChinese}的製作過程</h3>
                            <p>咚咕哩成長史</p>
                            
                            <div class="mo-gallery" id="mo-gallery-${safeId}"></div>
                        </div>
                    </div>

                    <div class="content-container">
                        <div class="tech-disclaimer" style="margin-bottom: 40px;">
                            每件作品皆為手工製作，不對稱或不夠精準皆為手作的痕跡。<br>
                            施釉層可能出現流釉、縮釉、小針孔皆為可能發生之情況。
                        </div>
                    </div>
                `;
                pagesRoot.appendChild(pageDiv);
                
                if(bannerImages.length > 0) renderSlideshow(`banner-${safeId}`, bannerImages);
                renderProductGrid('grid-' + safeId, cat);
                renderMakingOfGallery(cat, safeId);
            });
        }

        // --- Making Gallery 函數 (讀取 data.json) ---
        async function renderMakingOfGallery(categoryName, safeId) {
            const galleryRoot = document.getElementById(`mo-gallery-${safeId}`);
            const sectionRoot = document.getElementById(`mo-section-${safeId}`);
            
            if (!galleryRoot || !sectionRoot) return;

            // 清空舊內容
            galleryRoot.innerHTML = '';

            // 在 configs (data.json) 中尋找對應 key 的 MakingGallery 設定
            // 如果是 about 頁面，key 應該是 'about'
            const configKey = categoryName === 'about' ? 'about' : categoryName;
            const config = configs.find(c => c.type === 'MakingGallery' && c.key === configKey);

            if (config && config.image) {
                // 處理 image 欄位 (可能是字串陣列或逗號分隔字串)
                let images = [];
                if (Array.isArray(config.image)) {
                    images = config.image;
                } else if (typeof config.image === 'string' && config.image.trim() !== '') {
                    images = config.image.split(',').map(s => s.trim());
                }

                if (images.length > 0) {
                    images.forEach(src => {
                        const div = document.createElement('div');
                        div.className = 'mo-item';
                        
                        // 判斷是否為影片
                        const isVideo = src.match(/\.(mp4|mov|webm)$/i);

                        if (isVideo) {
                            const video = document.createElement('video');
                            video.src = src;
                            video.autoplay = true; // 自動播放
                            video.muted = true;    // 靜音 (必要)
                            video.loop = true;     // 循環
                            video.playsInline = true;
                            video.controls = false; // 隱藏控制器
                            video.preload = "metadata"; 
                            
                            // 點擊打開 Lightbox (可看有聲版)
                            div.onclick = () => openProductLightbox([src], `Making of ${categoryName}`);
                            div.appendChild(video);
                        } else {
                            const img = document.createElement('img');
                            img.src = src;
                            img.loading = "lazy";
                            img.decoding = "async";
                            // 點擊放大
                            div.onclick = () => openProductLightbox([src], `Making of ${categoryName}`);
                            div.appendChild(img);
                        }
                        
                        galleryRoot.appendChild(div);
                    });

                    // 有內容才顯示區塊
                    sectionRoot.style.display = 'block';
                } else {
                    sectionRoot.style.display = 'none';
                }
            } else {
                sectionRoot.style.display = 'none';
            }
        }

        function createProductCard(item) {
            const isSold = item.status === 'SOLD OUT';
            
            let rawSource = item.images || item.image;
            const mediaList = Array.isArray(rawSource) ? rawSource : [rawSource];
            
            const mainSrc = mediaList[0];
            const hoverSrc = mediaList.length > 1 ? mediaList[1] : null;
            const mediaJson = JSON.stringify(mediaList).replace(/"/g, '&quot;');
            
            const noteText = item.notes || '';
            const safeNote = noteText.replace(/"/g, '&quot;').replace(/'/g, "\\'"); 
            const noteHtml = noteText ? `<div class="note-overlay">${noteText}</div>` : '';
            
            const hasHoverClass = hoverSrc ? 'has-hover' : '';

            const isVideo = (src) => src && src.match(/\.(mp4|webm|mov)$/i);

            const getMediaHtml = (src, className) => {
                if (!src) return '';
                if (isVideo(src)) {
                    return `<video class="${className}" src="${src}" autoplay muted loop playsinline disablepictureinpicture onloadeddata="this.classList.add('loaded')"></video>`;
                } else {
                    return `<img class="${className}" src="${src}" loading="lazy" decoding="async" alt="${item.name}" onload="this.classList.add('loaded')">`;
                }
            };

            const mainHtml = getMediaHtml(mainSrc, 'img-main');
            const hoverHtml = getMediaHtml(hoverSrc, 'img-hover');

            let statusHtml = '';
            if (isSold) {
                statusHtml = `<div class="p-status">${item.status}</div>`;
            } else {
                statusHtml = `<a href="${ORDER_FORM_LINK}" target="_blank" class="p-status available">Available‧點我訂購</a>`;
            }

            return `
                <article class="product-card ${hasHoverClass}">
                    <div class="img-box" onclick="openProductLightbox(${mediaJson}, '${safeNote}')">
                        ${mainHtml}
                        <div class="skeleton"></div>
                        ${hoverHtml}
                        ${noteHtml}
                    </div>
                    <div class="p-code">${item.code}</div>
                    <div class="p-name">${item.name}</div>
                    <div class="p-price">NT$ ${item.price}</div>
                    ${statusHtml}
                </article>
            `;
        }

        function renderProductGrid(gridId, categoryFilter) {
            const grid = document.getElementById(gridId);
            if(!grid) return;
            const items = products.filter(p => {
                if (categoryFilter && p.category !== categoryFilter) return false;
                if (isHideSoldOut && p.status === 'SOLD OUT') return false;
                return true;
            });

            if(items.length === 0) grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:#999; padding:50px;">暫無商品 / No Items Found</div>';
            else grid.innerHTML = items.map(item => createProductCard(item)).join('');
        }

        function renderAvailablePage() {
            const grid = document.getElementById('grid-available');
            if(!grid) return;
            const items = products.filter(p => p.status !== 'SOLD OUT');
            
            if(items.length === 0) grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:#999; padding:50px;">目前沒有現貨 / Out of Stock</div>';
            else grid.innerHTML = items.map(item => createProductCard(item)).join('');
        }
                
        function updateJsonLd(pageId, categoryName = null) {
            const scriptTag = document.getElementById('json-ld-data');
            
            const baseUrl = window.location.origin; 
            
            let data = {};

            if (pageId === 'home') {
                data = {
                    "@context": "https://schema.org",
                    "@type": "WebSite",
                    "name": "DONGULI | 咚咕哩",
                    "url": baseUrl,
                    "potentialAction": {
                        "@type": "SearchAction",
                        "target": baseUrl + "/?page={search_term_string}",
                        "query-input": "required name=search_term_string"
                    }
                };
            } else if (pageId === 'about') {
                data = {
                    "@context": "https://schema.org",
                    "@type": "AboutPage",
                    "mainEntity": {
                        "@type": "Organization",
                        "name": "DONGULI",
                        "logo": baseUrl + "/assets/favicon.ico",
                        "description": "一顆橡實，靜靜落地。DONGULI 的每件陶作都承載著手作的溫度。"
                    }
                };
            } else if (pageId.startsWith('cat-') || pageId === 'available') {
                const targetItems = products.filter(p => {
                    if (pageId === 'available') return p.status !== 'SOLD OUT';
                    if (categoryName) return p.category === categoryName && (!isHideSoldOut || p.status !== 'SOLD OUT');
                    return false;
                });

                const itemListElement = targetItems.slice(0, 20).map((item, index) => ({
                    "@type": "ListItem",
                    "position": index + 1,
                    "item": {
                        "@type": "Product",
                        "name": item.name,
                        "image": item.image.map(img => img.startsWith('http') ? img : baseUrl + '/' + img),
                        "description": item.notes || `Handmade ceramic: ${item.name}`,
                        "sku": item.code,
                        "offers": {
                            "@type": "Offer",
                            "priceCurrency": "TWD",
                            "price": item.price,
                            "availability": item.status === 'SOLD OUT' ? "https://schema.org/OutOfStock" : "https://schema.org/InStock",
                            "url": baseUrl + `?page=${categoryName ? categoryName.replace(/\s+/g, '') : 'available'}`
                        }
                    }
                }));

                data = {
                    "@context": "https://schema.org",
                    "@type": "ItemList",
                    "name": categoryName || "Available Stock",
                    "description": `DONGULI ${categoryName || "現貨"} 商品列表`,
                    "numberOfItems": targetItems.length,
                    "itemListElement": itemListElement
                };
            }

            scriptTag.textContent = JSON.stringify(data);
        }

        function updateMetaTags(title, description, path, ogImage = null) {
            document.title = title;
            let metaDesc = document.querySelector("meta[name='description']");
            if (!metaDesc) {
                metaDesc = document.createElement('meta');
                metaDesc.name = 'description';
                document.head.appendChild(metaDesc);
            }
            metaDesc.content = description;

            const baseUrl = window.location.origin + window.location.pathname;
            const finalUrl = path ? `${baseUrl}?page=${path}` : baseUrl;
            const canonicalLink = document.getElementById('canonical-link');
            if (canonicalLink) canonicalLink.href = finalUrl;
            
            // Use provided ogImage or fallback to home_hero.jpg
            const imageUrl = ogImage || '/assets/home_hero.jpg';
            const fullImageUrl = imageUrl.startsWith('http') ? imageUrl : window.location.origin + (imageUrl.startsWith('/') ? imageUrl : '/' + imageUrl);
            
            updateOpenGraph('og:title', title);
            updateOpenGraph('og:description', description);
            updateOpenGraph('og:url', finalUrl);
            updateOpenGraph('og:image', fullImageUrl);
            
            // Also update Twitter Card tags
            updateTwitterCard('twitter:title', title);
            updateTwitterCard('twitter:description', description);
            updateTwitterCard('twitter:image', fullImageUrl);
        }

        function updateOpenGraph(property, content) {
            let tag = document.querySelector(`meta[property='${property}']`);
            if (!tag) {
                tag = document.createElement('meta');
                tag.setAttribute('property', property);
                document.head.appendChild(tag);
            }            
            tag.setAttribute('content', content);
        }
        
        function updateTwitterCard(name, content) {
            let tag = document.querySelector(`meta[name='${name}']`);
            if (!tag) {
                tag = document.createElement('meta');
                tag.setAttribute('name', name);
                document.head.appendChild(tag);
            }
            tag.setAttribute('content', content);
        }              

        function switchPage(pageId, pushToHistory = true) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active-page'));
            
            let targetId = pageId;
            if (!pageId.startsWith('cat-') && pageId !== 'home' && pageId !== 'about' && pageId !== 'available') {
                    const idx = categories.findIndex(c => c.replace(/\s+/g, '') === pageId);
                    if (idx !== -1) targetId = 'cat-' + idx;
            }

            const target = document.getElementById('page-' + targetId);
            
            if(target) {
                target.classList.add('active-page');
                window.scrollTo(0, 0);
                
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                if(targetId === 'home') document.getElementById('btn-home').classList.add('active');
                else if(targetId === 'about') document.getElementById('btn-about').classList.add('active');
                else document.getElementById('btn-shop').classList.add('active'); 

                let newTitle = "DONGULI | 咚咕哩 - 自然・陶・生活";
                let newDesc = "DONGULI 來自於對自然的觀察與熱愛，每件作品都由雙手塑造，承載時間的痕跡與釉色的流動。";
                let urlParam = targetId;
                let catNameForJson = null;
                let ogImage = null;

                // Determine the appropriate banner image for OG tags
                if (targetId === 'home') {
                    // Use HomeHero image
                    const homeHeroConfig = configs.find(c => c.type === 'HomeHero');
                    if (homeHeroConfig) {
                        const images = Array.isArray(homeHeroConfig.image) ? homeHeroConfig.image : [homeHeroConfig.image];
                        ogImage = images[0];
                    }
                } else if (targetId === 'about') {
                    newTitle = "About us 關於我們 | DONGULI";
                    newDesc = "一顆橡實，靜靜落地。DONGULI 的每件陶作都承載著手作的溫度，在陶土的粗糙與釉色的溫潤之間，尋找平衡。";
                    urlParam = 'about';
                    
                    // Use about Banner image
                    const aboutBannerConfig = configs.find(c => c.type === 'Banner' && c.key === 'about');
                    if (aboutBannerConfig) {
                        const images = Array.isArray(aboutBannerConfig.image) ? aboutBannerConfig.image : [aboutBannerConfig.image];
                        ogImage = images[0];
                    }
                } else if (targetId === 'available') {
                    newTitle = "Available Stock 現貨選購 | DONGULI";
                    newDesc = "瀏覽 DONGULI 目前可購買的現貨作品。每件都獨一無二，尋找屬於你的生活陶器。";
                    urlParam = 'available';
                    
                    // Use home_hero.jpg as fallback for available page
                    ogImage = '/assets/home_hero.jpg';
                } else if (targetId.startsWith('cat-')) {
                    const catIndex = parseInt(targetId.replace('cat-', ''));
                    if (categories && categories[catIndex]) {
                        const catName = categories[catIndex];
                        catNameForJson = catName; 
                        
                        newTitle = `${catName} | DONGULI 陶瓷作品`;
                        newDesc = `選購 DONGULI ${catName} 系列。手捏質感，獨特釉色，為生活增添自然的氣息。`;
                        
                        // Use category-specific Banner image
                        const bannerConfig = configs.find(c => c.type === 'Banner' && c.key === catName);
                        if (bannerConfig) {
                            const images = Array.isArray(bannerConfig.image) ? bannerConfig.image : [bannerConfig.image];
                            ogImage = images[0];
                        }
                        
                        const toggleBtn = target.querySelector('.toggle-btn');
                        if (toggleBtn) {
                            if (isHideSoldOut) toggleBtn.classList.add('active');
                            else toggleBtn.classList.remove('active');
                        }
                        
                        renderProductGrid('grid-' + targetId, catName);
                        urlParam = catName.replace(/\s+/g, ''); 
                    }
                }

                updateMetaTags(newTitle, newDesc, targetId === 'home' ? '' : urlParam, ogImage);
                
                updateJsonLd(targetId, catNameForJson);

                if (pushToHistory) {
                    const newUrl = targetId === 'home' ? window.location.pathname : `?page=${urlParam}`;
                    window.history.pushState({ page: urlParam }, newTitle, newUrl);
                }
            }
        }

        function toggleStock(btn, safeId, cat) {
            isHideSoldOut = !isHideSoldOut;
            if(isHideSoldOut) btn.classList.add('active');
            else btn.classList.remove('active');
            renderProductGrid('grid-' + safeId, cat);
        }

        function openProductLightbox(imagesArray, noteText) {
            currentLbImages = imagesArray;
            currentLbIndex = 0;
            currentLbNote = noteText || "";
            updateLightboxContent();
            
            const lightbox = document.getElementById('lightbox');
            lightbox.style.display = 'flex';
            
            const caption = document.getElementById('lightbox-caption');
            if(currentLbNote) {
                caption.innerText = currentLbNote;
                caption.classList.add('has-text');
            } else {
                caption.innerText = '';
                caption.classList.remove('has-text');
            }

            setTimeout(() => { lightbox.classList.add('active'); }, 10);
            document.body.style.overflow = 'hidden';
            
            const prevBtn = document.getElementById('lb-prev');
            const nextBtn = document.getElementById('lb-next');
            if(currentLbImages.length > 1) {
                prevBtn.style.display = 'block';
                nextBtn.style.display = 'block';
            } else {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            }
        }

        function updateLightboxContent() {
            const wrapper = document.getElementById('lightbox-wrapper');
            const src = currentLbImages[currentLbIndex];
            const isVideo = src.match(/\.(mp4|webm|mov)$/i);

            wrapper.innerHTML = ''; 

            if (isVideo) {
                const video = document.createElement('video');
                video.className = 'lightbox-content';
                video.controls = true; video.autoplay = true; video.loop = true;
                video.playsInline = true; video.src = src; video.muted = false; 
                wrapper.appendChild(video);
            } else {
                const img = document.createElement('img');
                img.className = 'lightbox-content';
                img.src = src;
                img.alt = 'Gallery Image';
                wrapper.appendChild(img);
            }
        }

        function changeLightboxItem(dir) {
            if (currentLbImages.length <= 1) return;
            currentLbIndex += dir;
            if (currentLbIndex >= currentLbImages.length) currentLbIndex = 0;
            if (currentLbIndex < 0) currentLbIndex = currentLbImages.length - 1;
            updateLightboxContent();
        }

        function closeLightbox(e) {
            if (!e.target.classList.contains('lightbox-content') && !e.target.classList.contains('lb-btn')) {
                const lightbox = document.getElementById('lightbox');
                lightbox.classList.remove('active');
                document.getElementById('lightbox-wrapper').innerHTML = '';
                setTimeout(() => { lightbox.style.display = 'none'; }, 300);
                if(!document.body.classList.contains('menu-open')) document.body.style.overflow = '';
            }
        }

        document.addEventListener('keydown', function(e) {
            const lightbox = document.getElementById('lightbox');
            if (lightbox.style.display === 'flex') {
                if (e.key === 'ArrowLeft') changeLightboxItem(-1);
                if (e.key === 'ArrowRight') changeLightboxItem(1);
                if (e.key === 'Escape') closeLightbox({target: lightbox});
            }
        });

        function toggleMenu() {
            const menu = document.getElementById('nav-menu');
            const overlay = document.querySelector('.menu-overlay');
            const hamburger = document.getElementById('hamburger-btn');
            const isOpen = menu.classList.toggle('open');
            overlay.classList.toggle('active');
            hamburger.classList.toggle('active');
            hamburger.setAttribute('aria-expanded', isOpen);
            document.body.classList.toggle('menu-open');
        }

        function closeMenu() {
            const menu = document.getElementById('nav-menu');
            const overlay = document.querySelector('.menu-overlay');
            const hamburger = document.getElementById('hamburger-btn');
            menu.classList.remove('open');
            overlay.classList.remove('active');
            hamburger.classList.remove('active');
            hamburger.setAttribute('aria-expanded', 'false');
            document.body.classList.remove('menu-open');
            setTimeout(() => {
                const inner = document.getElementById('shop-dropdown-inner');
                const btn = document.getElementById('btn-shop');
                if(inner) inner.classList.remove('show');
                if(btn) btn.classList.remove('open');
            }, 300);
        }

        function toggleMobileShop(e) {
            const hamburger = document.getElementById('hamburger-btn');
            if (window.getComputedStyle(hamburger).display !== 'none') {
                const inner = document.getElementById('shop-dropdown-inner');
                const btn = document.getElementById('btn-shop');
                inner.classList.toggle('show');
                btn.classList.toggle('open');
            } else {
                handleNavClick('available');
            }
        }

        window.addEventListener('DOMContentLoaded', initWebsite);
    </script>
</body>
</html>